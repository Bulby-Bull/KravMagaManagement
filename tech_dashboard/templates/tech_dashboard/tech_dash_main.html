<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Techniques</title>
    <link rel="stylesheet" href="{% static 'tech_dashboard/css/tech_dash_main.css' %}">
</head>
    <body>
        <table class="nested-table">
            <thead>
                <tr>
                    <th>Technique</th>
                    <th>Position</th>
                    <th>Date vue</th>
                    <th>Date de révision</th>
                    <th>Note</th>
                    <th>Page livre</th>
                    <th>Réf Programme</th>
                </tr>
            </thead>

            <tbody>
                {% for belt, uvs in tree.items %}
                <!-- BELT -->
                <tr class="node level-0" data-id="belt-{{ forloop.counter }}">
                    <td>
                        <button class="toggle">▶</button>
                        <strong>{{ belt }}</strong>
                    </td>
                    <td colspan="3"></td>
                </tr>

                    {% for uv, categories in uvs.items %}
                    <!-- UV -->
                    <tr class="node level-1 hidden" data-parent="belt-{{ forloop.parentloop.counter }}" data-id="uv-{{ forloop.counter }}">
                        <td>
                            <button class="toggle">▶</button>
                            {{ uv }}
                        </td>
                        <td colspan="3"></td>
                    </tr>

                        {% for category, subcats in categories.items %}
                        <!-- CATEGORY -->
                        <tr class="node level-2 hidden"
                            data-parent="uv-{{ forloop.parentloop.counter }}"
                            data-id="cat-{{ forloop.counter }}">
                            <td>
                                <button class="toggle">▶</button>
                                {{ category }}
                            </td>
                            <td colspan="3"></td>
                        </tr>

                            {% for subcat, techniques in subcats.items %}
                            <!-- SUBCATEGORY -->
                            <tr class="node level-3 hidden"
                                data-parent="cat-{{ forloop.parentloop.counter }}"
                                data-id="sub-{{ forloop.counter }}">
                                <td>
                                    <button class="toggle">▶</button>
                                    {{ subcat }}
                                </td>
                                <td colspan="3"></td>
                            </tr>

                                {% for technique in techniques %}
                                <!-- TECHNIQUE (LEAF) -->
                                <tr class="leaf level-4 hidden"
                                    data-parent="sub-{{ forloop.parentloop.counter }}">
                                    <td id="tech_name">
                                        <input type="checkbox"
                                            {% if technique.viewed_technique %}checked{% endif %}>
                                        {{ technique.technique }}
                                    </td>
                                    <td id="tech_pos">
                                        {{ technique.position }}
                                    </td>
                                    <td>
                                        {{ technique.viewed_date }}
                                    </td>
                                    <td>
                                        {{ technique.revision_date }}
                                    </td>
                                    <td id="tech_note">
                                        {{ technique.note }}
                                    </td>
                                    <td>
                                        {{ technique.official_book_ref_page }}
                                    </td>
                                    <td>
                                        {{ technique.official_prog_ref_2025 }}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>

    <script src="{% static 'tech_dashboard/js/tech_dash_main.js' %}"></script>
    </body>
</html>